@using System.Collections.Generic
@using CrystalSoftware.ERP.Border
@model IEnumerable<ApplicationUser>
@{
    Layout = "Layout/_Layout";
}

@section styles {
    <link href="https://cdn.datatables.net/datetime/1.1.1/css/dataTables.dateTime.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/searchpanes/1.4.0/css/searchPanes.dataTables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/searchbuilder/1.3.0/css/searchBuilder.dataTables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="https://datatables.net/extensions/searchpanes/examples/initialisation/forceShow.html" rel="stylesheet" />
}

<section class="content">
    <div class="container-fluid">
        <div class="row" style="margin-bottom: 10px"></div>

        @if (Model != null && Model.Any())
        {
            <div class="card">
                <div class="card-body">
                    <table id="users-table" class="table table-bordered display nowrap" style="width:100%">
                        <thead>
                            <tr>
                                <th>Usuário</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Telefone</th>
                                <th>Data de criação</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.UserName</td>
                                    <td>@item.FullName</td>
                                    <td>
                                        @Html.DisplayFor(x => item.Email)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(x => item.PhoneNumber)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(x => item.CreationDate)
                                    </td>
                                    <td>
                                        <button class="btn" href="@Url.Action("Profile","Account", new { username = item.UserName })"><i class="fas fa-user-edit"></i></button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <th>Usuário</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Telefone</th>
                                <th>Data de criação</th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        }
    </div>
</section>


@section scripts {
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/searchbuilder/1.3.0/js/dataTables.searchBuilder.min.js"></script>
    <script src="https://cdn.datatables.net/searchpanes/1.4.0/js/dataTables.searchPanes.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>
    <script src="https://cdn.datatables.net/datetime/1.1.1/js/dataTables.dateTime.min.js"></script>

    <script>
        $(document).ready(function () {
            $(function () {
                $.ajax({
                    type: "POST",
                    url: "/Account/GetUsersData",
                    success: function (response) {
                        OnSuccess(response);
                    },
                    failure: function (response) {
                        alert(response.d);
                    },
                    error: function (response) {
                        alert(response.d);
                    }
                });
            });

            function OnSuccess(response) {
                $('#users-table').DataTable({
                    dom: 'PQlfrtip',
                });
            };
        });
    </script>
}